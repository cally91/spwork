package com.biz.iolist.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Service;

import com.biz.iolist.Model.MemberVO;
import com.biz.iolist.mapper.MemberDao;

import lombok.extern.slf4j.Slf4j;

@Slf4j
@Service
public class MemberService {
	
	@Autowired
	MemberDao mDao;
	
	@Autowired
	BCryptPasswordEncoder passwordEncoder;
	
	public String check_id(String m_userid) {
		return mDao.check_id(m_userid);
	}

	public int insert(MemberVO memberVO) {
		
		// plan text : 평문
		String strPassword=memberVO.getM_password();
		//crypt text:암호화된 문자열
		String cryptPassword =passwordEncoder.encode(strPassword);
		log.debug("비밀번호 : " +strPassword +":" +cryptPassword);
		
		memberVO.setM_password(cryptPassword);
		/*
		 * 최초로 가입되는 회원에게 ADMIN 권한을 부여하고
		 * 이후 부터는 
		 */
		
		List<MemberVO> memList=mDao.selectAll();
		if(memList.size()>0) memberVO.setM_role("USER");
		else memberVO.setM_role("ADMIN");
		int ret=mDao.insert(memberVO);
		return 0;
	}

	public MemberVO login_check(MemberVO memberVO) {
		
		MemberVO re_memberVO = mDao.login_check(memberVO);
		
		return null;
	}
}
